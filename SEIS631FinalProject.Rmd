---
title: "SEIS631 Final Project"
author: "Nikolai"
date: "5/4/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(viridis)
library(hrbrthemes)
library(plyr)
personalityData <- read_csv("data.csv")

Convert_Negative_score <- function(x) {return (5-x)}
```

## Introduction
Personality has always been a fascination of mine. While many personality tests have little validity or predictive value, The Big Five personality tests have a reputation of being a good measure with predictive power. I have found a publicly available dataset of demographic information and personality data that I wish to analyze using techniques taught in class.


## What
As mentioned earlier, the Big Five Personality test is thought to be one of the more accurate and predictive personality tests for human behavior. For example, having a combination of high Agreeableness and Conscientiousness usually means the person is going to be a good employee while having high neuroticism is related to a variety of bad outcomes. I would like to see if there are relationships between the expression of different personality traits across countries and gender. 

## Why
While we know that the expression of certain combinations of personality traits predict certain behaviors, these traits are often seen as being separate and distinct measures of personality. I argue that there are likely 'personality types' - combinations of these traits that are more likely to occur together - that define subsets of the population.

## How
My plan is to subset the dataset while controlling for the expression of one or more personality traits. Using these traits as a control, I will look to see if the other traits expression in this subset is significantly different from the normal population. 

## Body

## Cleaning the data.
The dataset was quite large and had demographic information and the actual responses to the individual questions. While this is ideal, it means the dataset must be cleaned to be useful. For example, to account for the tendency to give high ratings over low ratings regardless of the question's content, several of the questions are stated negatively. For example, on a rating of 1-5, answering the question 'I like to talk' with a 5 would be high extroversion, but answering the question 'I don't like loud parties' with a 5 would actually be the opposite. I will write a function to inverse a question's rating and then manually code which questions are positive or negative and apply the function only to negative questions. Then, because there would be too many rows with this dataset if looking only at the individual questions, I will average the answers per trait to get a single score for the five traits.

```{r, echo=FALSE}
PDClean <- personalityData
PDClean$E2 <- Convert_Negative_score(PDClean$E2)
PDClean$E4 <- Convert_Negative_score(PDClean$E4)
PDClean$E6 <- Convert_Negative_score(PDClean$E6)
PDClean$E8 <- Convert_Negative_score(PDClean$E8)
PDClean$E10 <- Convert_Negative_score(PDClean$E10)

PDClean$N2 <- Convert_Negative_score(PDClean$N2)
PDClean$N4 <- Convert_Negative_score(PDClean$N4)

PDClean$A1 <- Convert_Negative_score(PDClean$A1)
PDClean$A3 <- Convert_Negative_score(PDClean$A3)
PDClean$A5 <- Convert_Negative_score(PDClean$A5)
PDClean$A7 <- Convert_Negative_score(PDClean$A7)

PDClean$C2 <- Convert_Negative_score(PDClean$C2)
PDClean$C4 <- Convert_Negative_score(PDClean$C4)
PDClean$C6 <- Convert_Negative_score(PDClean$C6)
PDClean$C8 <- Convert_Negative_score(PDClean$C8)

PDClean$O2 <- Convert_Negative_score(PDClean$O2)
PDClean$O4 <- Convert_Negative_score(PDClean$O4)
PDClean$O6 <- Convert_Negative_score(PDClean$O6)

```


```{r, echo=FALSE}

PDClean$Extraversion <- with(PDClean, (E1+E2+E3+E4+E5+E6+E7+E8+E9+E10)/10)
PDClean$Neuroticism <- with(PDClean, 
                         (  N1+
                            N2+
                            N3+
                            N4+
                            N5+
                            N6+
                            N7+
                            N8+
                            N9+
                            N10)/10)
PDClean$Openness <- with(PDClean, 
                         (  O1+
                            O2+
                            O3+
                            O4+
                            O5+
                            O6+
                            O7+
                            O8+
                            O9+
                            O10)/10)

PDClean$Conscientiousness <- with(PDClean, 
                         (  C1+
                            C2+
                            C3+
                            C4+
                            C5+
                            C6+
                            C7+
                            C8+
                            C9+
                            C10)/10)

PDClean$Agreeableness <- with(PDClean, 
                         (  A1+
                            A2+
                            A3+
                            A4+
                            A5+
                            A6+
                            A7+
                            A8+
                            A9+
                            A10)/10)


PDClean <- na.omit(PDClean)
PDClean <- subset.data.frame(PDClean, gender != 0 & engnat < 3)


ggplot(PDClean, aes(x=age, y=Extraversion)) + geom_point(data = PDClean, mapping = aes(x=age, y=Extraversion, color=gender), alpha=.1, color="red") + xlim(10, 100)

ggplot(PDClean, aes(x=age, y=Openness)) + geom_point(data = PDClean, mapping = aes(x=age, y=Openness, color=gender), alpha=.1) + xlim(10, 100)

ggplot(PDClean, aes(x=age, y=Conscientiousness)) + geom_point(data = PDClean, mapping = aes(x=age, y=Conscientiousness, color=gender), alpha=.1) + xlim(10, 100)

ggplot(PDClean, aes(x=age, y=Neuroticism)) + geom_point(data = PDClean, mapping = aes(x=age, y=Neuroticism, color=gender), alpha=.1) + xlim(10, 100)

ggplot(PDClean, aes(x=age, y=Agreeableness)) + geom_point(data = PDClean, mapping = aes(x=age, y=Agreeableness, color=gender), alpha=.1) + xlim(10, 100)
```
If we take the averages of all of the question's scores for each trait for respondents in the US, we see that most respondents were age 25 or younger. We also see trends, such as Agreeableness and Openness tend to be higher than 2. Conscientiousness and Neuroticism seem to avoid the valences of 1 and 5.Extroversion, on the other hand, appears to be across the board.looking at the above graph of age versus extroversion, it seems there is little relation between age and being introverted or extroverted with the exception of after age 60 it appears like less people are strongly introverted. 

```{r, echo=FALSE}

CountryCount <- count(PDClean$country)
CountryCount <- data.frame(country = CountryCount$x, count = CountryCount$freq)
TopCountries <- subset.data.frame(CountryCount, CountryCount$count > 500)


```

As seen by this R code, the top countries with observations in this dataset are English speaking countries. I will be looking at these countries next and similarities and differences within these countries to see if country, age, and sex result in significant differences. 


```{r, echo=FALSE}
CCmajor <- subset.data.frame(CountryCount, count > 400)

CCminor <- subset.data.frame(CountryCount, count <= 400)

CCminorOne <- sum(CCminor$count)

CCminoragain <- data.frame(country = "Other", count = CCminorOne)

CCCombined <- rbind(CCmajor, CCminoragain)

CCCombined <- CCCombined %>% 
  arrange(desc(country)) %>%
  mutate(prop = CCCombined$count / sum(CCCombined$count) *100) %>%
  mutate(ypos = cumsum(prop)- 0.5*prop )

ggplot(CCCombined, aes(x="", y=count, fill=country)) +
  geom_bar(stat="identity", width=1) + coord_polar("y", start=0)


```

```{r, echo=FALSE}

PDmajor <- subset.data.frame(PDClean, country == "AU" | country == "US" | country == "CA" | country == "GB" | country == "IN" | country == "PH")

PDminor <- subset.data.frame(PDClean, country != "AU" & country != "US" & country != "CA" & country != "GB" & country != "IN" & country != "PH")

PDmajoragain <- data.frame(race = PDmajor$race,age = PDmajor$age,engnat =  PDmajor$engnat, gender = PDmajor$gender, hand = PDmajor$hand, source = PDmajor$source, country = PDmajor$country, extroversion = PDmajor$Extraversion, neuroticism = PDmajor$Neuroticism,openness =  PDmajor$Openness,conscientiousness = PDmajor$Conscientiousness, agreeableness = PDmajor$Agreeableness)

PDminoragain <- data.frame(race = PDminor$race,age = PDminor$age, engnat = PDminor$engnat,  gender = PDminor$gender, hand = PDminor$hand, source = PDminor$source, country = "Other", extroversion = PDminor$Extraversion, neuroticism = PDminor$Neuroticism, openness = PDminor$Openness,conscientiousness =  PDminor$Conscientiousness, agreeableness = PDminor$Agreeableness)

PDcombined <- rbind(PDmajoragain, PDminoragain)

PDcombined$sex <- mapvalues(PDcombined$gender, from = c(1,2,3), to = c("Male", "Female", "Other"))

PDcombined$engnatLabel <- mapvalues(PDcombined$gender, from = c(1,2), to = c("Native English", "Not Native English"))

PDCombinedMelted <- pivot_longer(PDcombined, cols=c("extroversion", "conscientiousness", "openness", "agreeableness", "neuroticism"))

PDCombinedMelted %>%
  ggplot( aes(x=country, y=value, fill=name)) +
    geom_boxplot() +
    scale_fill_viridis(discrete = TRUE, alpha=0.3) +
    geom_jitter(color="blue", size=0.4, alpha=0.01) +
    theme(
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
      plot.title = element_text(size=11)
    ) +
    ggtitle("Traits by Country Boxplot") +
    xlab("") 

PDCombinedMelted %>%
  ggplot( aes(x=engnatLabel, y=value, fill=name)) +
    geom_boxplot() +
    scale_fill_viridis(discrete = TRUE, alpha=0.3) +
    geom_jitter(color="blue", size=0.4, alpha=0.01) +
    theme(
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
      plot.title = element_text(size=11)
    ) +
    ggtitle("Traits by English Nativity Boxplot") +
    xlab("") 

```

```{r, echo=FALSE}



PDGender <- PDcombined

PDCombinedMelted %>%
  ggplot( aes(x=name, y=value, fill=sex)) +
    geom_boxplot() +
    scale_fill_viridis(discrete = TRUE, alpha=0.3) +
    geom_jitter(color="blue", size=0.4, alpha=0.01) +
    theme(
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
      plot.title = element_text(size=11)
    ) +
    ggtitle("Traits by Gender Boxplot") +
    xlab("")

```

```{r, echo=FALSE}

HighExtroversion <- subset.data.frame(PDGender, extroversion >= 4)


HighEMelted <- pivot_longer(HighExtroversion, cols=c("extroversion", "conscientiousness", "openness", "agreeableness", "neuroticism"))

HighEMelted %>%
  ggplot( aes(x=name, y=value, fill=sex)) +
    geom_boxplot() +
    scale_fill_viridis(discrete = TRUE, alpha=0.3) +
    geom_jitter(color="blue", size=0.4, alpha=0.05) +
    theme(
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
      plot.title = element_text(size=11)
    ) +
    ggtitle("Traits by Gender with High Extroversion Boxplot") +
    xlab("")

```

```{r, echo=FALSE}

LowExtroversion <- subset.data.frame(PDGender, extroversion <= 2)


LowEMelted <- pivot_longer(LowExtroversion, cols=c("extroversion", "conscientiousness", "openness", "agreeableness", "neuroticism"))

LowEMelted %>%
  ggplot( aes(x=name, y=value, fill=sex)) +
    geom_boxplot() +
    scale_fill_viridis(discrete = TRUE, alpha=0.3) +
    geom_jitter(color="blue", size=0.4, alpha=0.01) +
    theme(
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
      plot.title = element_text(size=11)
    ) +
    ggtitle("Traits by Gender with Low Extroversion Boxplot") +
    xlab("")

```


```{r, echo=FALSE}

LowAC <- subset.data.frame(PDGender, agreeableness <= 2 & conscientiousness <= 2 )


LowACMelted <- pivot_longer(LowAC, cols=c("extroversion", "conscientiousness", "openness", "agreeableness", "neuroticism"))

LowACMelted %>%
  ggplot( aes(x=name, y=value, fill=sex)) +
    geom_boxplot() +
    scale_fill_viridis(discrete = TRUE, alpha=0.3) +
    geom_jitter(color="blue", size=0.4, alpha=0.05) +
    theme(
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
      plot.title = element_text(size=11)
    ) +
    ggtitle("Traits by Gender with Low Agreeableness and Conscientiousness Boxplot") +
    xlab("")

LowACMelted %>%
  ggplot( aes(x=country, y=value, fill=name)) +
    geom_boxplot() +
    scale_fill_viridis(discrete = TRUE, alpha=0.3) +
    geom_jitter(color="blue", size=0.4, alpha=0.05) +
    theme(
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
      plot.title = element_text(size=11)
    ) +
    ggtitle("Traits by Country with Low Agreeableness and Conscientiousness Boxplot") +
    xlab("")

```

```{r, echo=FALSE}

HighAC <- subset.data.frame(PDGender, agreeableness >= 4 & conscientiousness >= 4 )


HighACMelted <- pivot_longer(HighAC, cols=c("extroversion", "conscientiousness", "openness", "agreeableness", "neuroticism"))

HighACMelted %>%
  ggplot( aes(x=name, y=value, fill=sex)) +
    geom_boxplot() +
    scale_fill_viridis(discrete = TRUE, alpha=0.3) +
    geom_jitter(color="blue", size=0.4, alpha=0.05) +
    theme(
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
      plot.title = element_text(size=11)
    ) +
    ggtitle("Traits by Gender with High Agreeableness and Conscientiousness Boxplot") +
    xlab("")


HighACMelted %>%
  ggplot( aes(x=country, y=value, fill=name)) +
    geom_boxplot() +
    scale_fill_viridis(discrete = TRUE, alpha=0.3) +
    geom_jitter(color="blue", size=0.4, alpha=0.05) +
    theme(
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
      plot.title = element_text(size=11)
    ) +
    ggtitle("Traits by Country with High Agreeableness and Conscientiousness Boxplot") +
    xlab("")

```

```{r, echo=FALSE}

PDGender$ACavg <- (PDGender$agreeableness+PDGender$conscientiousness)/2

ggplot(PDGender, aes(x=ACavg, y=extroversion)) + geom_point(data = PDGender, mapping = aes(x=ACavg, y=extroversion, color=country), alpha=.1) + xlim(0, 5) +
    ggtitle("Agreeableness and Conscientiousness Average relationship with Extroversion Scatter Plot") +
    xlab("")

ggplot(PDGender, aes(x=ACavg, y=neuroticism)) + geom_point(data = PDGender, mapping = aes(x=ACavg, y=neuroticism, color=country), alpha=.1) + xlim(0, 5) +
    ggtitle("Agreeableness and Conscientiousness Average relationship with Neuroticism Scatter Plot") +
    xlab("")

ggplot(PDGender, aes(x=ACavg, y=openness)) + geom_point(data = PDGender, mapping = aes(x=ACavg, y=openness, color=country), alpha=.1) + xlim(0, 5) +
    ggtitle("Agreeableness and Conscientiousness Average relationship with Openness to Experience Scatter Plot") +
    xlab("")

```

```{r, echo=FALSE}

PDGender$ACavg <- (PDGender$agreeableness+PDGender$conscientiousness)/2

OtherCountries <- subset.data.frame(PDGender, country == "Other")

ggplot(PDGender, aes(x=agreeableness, y=extroversion)) + geom_point(data = PDGender, mapping = aes(x=agreeableness, y=extroversion, color=country), alpha=.1) + xlim(0, 5) +
    ggtitle("Agreeableness relationship with Extroversion Scatter Plot") +
    xlab("")

ggplot(PDGender, aes(x=conscientiousness, y=extroversion)) + geom_point(data = PDGender, mapping = aes(x=conscientiousness, y=extroversion, color=country), alpha=.1) + xlim(0, 5) +
    ggtitle("Conscientiousness relationship with Extroversion Scatter Plot") +
    xlab("")

ggplot(PDGender, aes(x=extroversion, y=neuroticism)) + geom_point(data = PDGender, mapping = aes(x=extroversion, y=neuroticism, color=country), alpha=.1) + xlim(0, 5) +
    ggtitle("Neuroticism relationship with Extroversion Scatter Plot") +
    xlab("")


ggplot(OtherCountries, aes(x=agreeableness, y=extroversion)) + geom_point(data = OtherCountries, mapping = aes(x=agreeableness, y=extroversion, color=country), alpha=.1) + xlim(0, 5) +
    ggtitle("Agreeableness relationship with Extroversion Scatter Plot") +
    xlab("")

ggplot(OtherCountries, aes(x=conscientiousness, y=extroversion)) + geom_point(data = OtherCountries, mapping = aes(x=conscientiousness, y=extroversion, color=country), alpha=.1) + xlim(0, 5) +
    ggtitle("Conscientiousness relationship with Extroversion Scatter Plot") +
    xlab("")

ggplot(OtherCountries, aes(x=extroversion, y=neuroticism)) + geom_point(data = OtherCountries, mapping = aes(x=extroversion, y=neuroticism, color=country), alpha=.1) + xlim(0, 5) +
    ggtitle("Neuroticism relationship with Extroversion Scatter Plot") +
    xlab("")

ggplot(PDGender, aes(x=agreeableness, y=extroversion)) + geom_point(data = PDGender, mapping = aes(x=agreeableness, y=extroversion, color=sex), alpha=.1) + xlim(0, 5) +
    ggtitle("Agreeableness relationship with Extroversion Scatter Plot") +
    xlab("")

ggplot(PDGender, aes(x=conscientiousness, y=extroversion)) + geom_point(data = PDGender, mapping = aes(x=conscientiousness, y=extroversion, color=sex), alpha=.1) + xlim(0, 5) +
    ggtitle("Conscientiousness relationship with Extroversion Scatter Plot") +
    xlab("")

ggplot(PDGender, aes(x=neuroticism, y=extroversion)) + geom_point(data = PDGender, mapping = aes(x=neuroticism, y=extroversion, color=sex), alpha=.1) + xlim(0, 5) +
    ggtitle("Neuroticism relationship with Extroversion Scatter Plot") +
    xlab("")

```
```{r, echo=FALSE}

PDGender$ANavg <- (PDGender$agreeableness+PDGender$neuroticism)/2


ggplot(PDGender, aes(x=ANavg, y=extroversion)) + geom_point(data = PDGender, mapping = aes(x=ANavg, y=extroversion, color=sex), alpha=.1) + xlim(0, 5) +
    ggtitle("Neuroticism Agreeableness Avg relationship with Extroversion Scatter Plot") +
    xlab("")

ggplot(PDGender, aes(x=ANavg)) + geom_histogram(data = PDGender, mapping = aes(x=ANavg, color=sex), alpha=.1) + xlim(0, 5) +
    ggtitle("Neuroticism Agreeableness Avg relationship with Extroversion Scatter Plot") +
    xlab("")

genderCount <- count(PDGender$sex)

ggplot(genderCount, aes(x="", y=freq, fill=x)) +
  geom_bar(stat="identity", width=1) + coord_polar("y", start=0)

ggplot(PDGender, aes(x=age, y=extroversion)) + geom_point(data = PDGender, mapping = aes(x=age, y=extroversion, color=sex), alpha=.1) + xlim(10, 100)
ggplot(PDGender, aes(x=age, y=openness)) + geom_point(data = PDGender, mapping = aes(x=age, y=openness, color=sex), alpha=.1) + xlim(10, 100)
ggplot(PDGender, aes(x=age, y=conscientiousness)) + geom_point(data = PDGender, mapping = aes(x=age, y=conscientiousness, color=sex), alpha=.1) + xlim(10, 100)
ggplot(PDGender, aes(x=age, y=neuroticism)) + geom_point(data = PDGender, mapping = aes(x=age, y=neuroticism, color=sex), alpha=.1) + xlim(10, 100)
ggplot(PDGender, aes(x=age, y=agreeableness)) + geom_point(data = PDGender, mapping = aes(x=age, y=agreeableness, color=sex), alpha=.1) + xlim(10, 100)

```



## Topics From Class
(a) Git
(b) RMarkdown
(c) Statistical concepts such as normal distributions, mean, standard deviations, percentiles, and areas under the curve
(d) Geometric distributions
(e) T tests to determine if two populations are significantly different.

## Conclusion


